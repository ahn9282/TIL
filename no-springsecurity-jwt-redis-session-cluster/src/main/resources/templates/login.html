<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>로그인</title>
    <link rel="stylesheet" href="/css/auth.css">
</head>
<body>
<div class="container">
    <h1>로그인</h1>
    <input type="text" id="username" placeholder="아이디" required>
    <input type="password" id="password" placeholder="비밀번호" required>

    <button onclick="login()">로그인</button>
    <button class="secondary" onclick="location.href='/'">홈으로</button>

    <div class="message">
        계정이 없으신가요? <a href="/signup">회원가입</a>
    </div>
</div>

<script src="/js/auth.js"></script>
<script>
    async function login() {
        const data = {
            username: document.getElementById('username').value,
            password: document.getElementById('password').value
        };

        try {
            const response = await fetch('/api/users/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                const result = await response.json();
                // 서버 응답 구조에 따라 수정 필요 (예: result.accessToken)
                // 여기서는 result 자체가 토큰 객체라고 가정하거나, 헤더에서 꺼내야 할 수도 있음.
                // 현재 UserServiceImpl 로직을 보면 UserDto를 반환하고 있음.
                // JWT 발급 로직이 Controller에 있어야 함.

                // *가정: 로그인 성공 시 JSON으로 { accessToken: "...", refreshToken: "..." } 반환*
                if (result.accessToken) {
                    Auth.setTokens(result.accessToken, result.refreshToken);
                    alert('로그인 성공!');
                    window.location.href = '/';
                } else {
                    alert('토큰을 받지 못했습니다.');
                }
            } else {
                alert('로그인 실패: 아이디나 비밀번호를 확인하세요.');
            }
        } catch (e) {
            console.error(e);
            alert('로그인 중 오류 발생');
        }
    }
</script>
</body>
</html>
